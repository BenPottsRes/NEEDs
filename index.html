<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey Mind Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; }
    h1 { text-align: centre; }           /* CSS only recognises 'center', but this only affects text alignment */
    #slider-container { margin: 1em; text-align: centre; }
    .node circle { fill: #69b3a2; stroke: #000; stroke-width: 1.5px; }
    .node text   { font: 14px sans-serif; }
    .link        { fill: none; stroke: #ccc; stroke-width: 1.5px; }
    svg          { display: block; margin: auto; }
  </style>
</head>
<body>
  <h1>Survey Mind Map</h1>
  <div id="slider-container">
    <label for="depthSlider">Show to level:</label>
    <input type="range" id="depthSlider" min="1" max="5" value="5">
  </div>
  <svg width="960" height="600"></svg>

  <!-- Inline JSON data -->
  <script id="mindmap-data" type="application/json">
  { /* your full JSON tree here, as before */ }
  </script>

  <script>
    const svg    = d3.select("svg"),
          width  = +svg.attr("width"),
          height = +svg.attr("height"),
          tree   = d3.tree().size([height, width - 160]);

    function update(depthLimit) {
      // 1. Parse data
      const raw  = document.getElementById("mindmap-data").textContent,
            data = JSON.parse(raw),
            root = d3.hierarchy(data);

      // 2. Compute layout (assigns x/y on each node)
      tree(root);

      // 3. Filter to desired depth
      const nodes = root.descendants().filter(d => d.depth <= depthLimit),
            links = root.links().filter(d => d.source.depth < depthLimit);

      // 4. Clear previous contents of the SVG
      svg.selectAll("*").remove();

      // 5. Recreate the group we draw into
      const g = svg.append("g")
                   .attr("transform", "translate(40,0)");

      // 6. Draw links
      g.selectAll(".link")
       .data(links)
       .enter().append("path")
         .attr("class", "link")
         .attr("d", d3.linkHorizontal()
                        .x(d => d.y)
                        .y(d => d.x));

      // 7. Draw nodes
      const nodeG = g.selectAll(".node")
                     .data(nodes)
                     .enter().append("g")
                       .attr("class", "node")
                       .attr("transform", d => `translate(${d.y},${d.x})`);

      nodeG.append("circle")
           .attr("r", 4.5);

      nodeG.append("text")
           .attr("dy", 3)
           .attr("x", d => d.children ? -8 : 8)
           .attr("text-anchor", d => d.children ? "end" : "start")
           .text(d => d.data.name);
    }

    // Bind the slider
    document.getElementById("depthSlider")
            .addEventListener("input", e => update(+e.target.value));

    // Initial render
    update(5);
  </script>
</body>
</html>
