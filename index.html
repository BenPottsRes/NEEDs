<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Survey Mind Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Basic page reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; overflow: hidden; }
    h1 { text-align: center; padding: 1rem 0; }

    /* Slider UI */
    #slider-container {
      position: absolute;
      top: 1rem; right: 1rem;
      background: rgba(255,255,255,0.9);
      padding: 0.5rem 1rem;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      font-size: 0.9rem;
      z-index: 1000;
    }
    #slider-container label { margin-right: 0.5rem; }

    /* SVG wrapper to allow horizontal scroll if needed */
    #svg-wrapper {
      width: 100vw;
      height: calc(100vh - 3rem);
      overflow: auto;
    }

    /* Tree styling */
    svg { display: block; }
    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 1.5px;
    }
    .node circle {
      fill: #69b3a2;
      stroke: #4a7c6b;
      stroke-width: 1px;
    }
    .node text {
      font: 12px sans-serif;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <h1>Survey Mind Map</h1>

  <!-- Depth slider -->
  <div id="slider-container">
    <label for="depthSlider">Levels:</label>
    <input type="range" id="depthSlider" min="1" max="3" value="3">
  </div>

  <!-- Scrollable SVG container -->
  <div id="svg-wrapper">
    <svg width="1400" height="600"></svg>
  </div>

  <!-- Inline JSON mind-map data -->
  <script id="mindmap-data" type="application/json">
{
  "name": "Survey Organisation",
  "children": [
    {
      "name": "Demographics",
      "children": [
        { "name": "Age Range" },
        { "name": "Ethnicity Group" },
        { "name": "Gender Identity" },
        { "name": "LGBTQ+" },
        { "name": "Region of the UK" }
      ]
    },
    {
      "name": "Attendance",
      "children": [
        {
          "name": "Attendance",
          "children": [
            { "name": "Reason for this" },
            { "name": "Previous attendance" },
            { "name": "Method of attendance, e.g. ambulance" }
          ]
        },
        {
          "name": "Non-attendance",
          "children": [
            { "name": "Reason / Barriers" },
            { "name": "Perceived Impact and Outcome" }
          ]
        },
        {
          "name": "Leaving without being seen",
          "children": [
            { "name": "Reason / Barriers" },
            { "name": "Perceived Impact and Outcome" }
          ]
        }
      ]
    },
    {
      "name": "Disclosure",
      "children": [
        {
          "name": "Decision on whether to do so",
          "children": [
            { "name": "Factors that are involved" }
          ]
        },
        {
          "name": "Method of doing so",
          "children": [
            { "name": "Pre-disclosed (hospital passport, alert on patient records system)" },
            { "name": "Self-advocacy" }
          ]
        },
        {
          "name": "Perceived impact of decision",
          "children": [
            { "name": "Better or worse due to disclosure" },
            { "name": "Better or worse due to non-disclosure" }
          ]
        }
      ]
    },
    {
      "name": "Experience",
      "children": [
        {
          "name": "Rating of care and experience",
          "children": [
            { "name": "Scales and quantifying" }
          ]
        },
        {
          "name": "Barriers and Enablers",
          "children": [
            { "name": "Challenging aspects of the experience" },
            { "name": "The aspects that help" }
          ]
        }
      ]
    },
    {
      "name": "Key Barriers",
      "children": [
        {
          "name": "Sensory and Environmental",
          "children": [
            { "name": "Noise, visual, smell, crowding, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        },
        {
          "name": "Structural and Procedural",
          "children": [
            { "name": "Logistics, waiting areas, waiting time, patient pathway, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        },
        {
          "name": "Communication with Staff",
          "children": [
            { "name": "Staff empathy, agreement with staff, feeling cared for and understood, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        }
      ]
    },
    {
      "name": "Pain",
      "children": [
        {
          "name": "Relationship with pain",
          "children": [
            { "name": "Perception" },
            { "name": "Tolerance" }
          ]
        },
        {
          "name": "Expressing and Communicating",
          "children": [
            { "name": "Staff empathy and understanding" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        }
      ]
    },
    {
      "name": "Final Comments",
      "children": [
        { "name": "Chance to say anything not covered" }
      ]
    }
  ]
}
  </script>

  <script>
    const svg    = d3.select("svg"),
          width  = +svg.attr("width"),
          height = +svg.attr("height"),
          tree   = d3.tree().size([height - 40, width - 200]);

    function update(depthLimit) {
      const raw  = document.getElementById("mindmap-data").textContent,
            data = JSON.parse(raw),
            root = d3.hierarchy(data);

      tree(root);

      const nodes = root.descendants().filter(d => d.depth <= depthLimit),
            links = root.links().filter(d => d.source.depth < depthLimit);

      svg.selectAll("*").remove();
      const g = svg.append("g").attr("transform", "translate(100,20)");

      // links
      g.selectAll(".link")
       .data(links)
       .enter().append("path")
         .attr("class", "link")
         .attr("d", d3.linkHorizontal()
                        .x(d => d.y)
                        .y(d => d.x));

      // nodes
      const nodeG = g.selectAll(".node")
                     .data(nodes)
                     .enter().append("g")
                       .attr("class", "node")
                       .attr("transform", d => `translate(${d.y},${d.x})`);

      nodeG.append("circle").attr("r", 4);
      nodeG.append("text")
           .attr("dy", 3)
           .attr("x", d => d.children ? -6 : 6)
           .attr("text-anchor", d => d.children ? "end" : "start")
           .text(d => d.data.name);
    }

    // bind slider
    document.getElementById("depthSlider")
            .addEventListener("input", e => update(+e.target.value));

    // initial render at 3 levels
    update(3);
  </script>
</body>
</html>
