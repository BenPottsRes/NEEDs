<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Survey Mind Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    h1 { text-align: center; margin: 0.5em 0; }
    #slider-container { text-align: center; margin-bottom: 0.5em; }
    /* Smaller text for fitting longer labels */
    .node text { font: 10px sans-serif; }
    .node circle { fill: #69b3a2; stroke: #000; stroke-width: 1px; }
    .link { fill: none; stroke: #ccc; stroke-width: 1px; }
    /* Make SVG scrollable if too wide */
    #svg-wrapper { overflow: auto; }
    svg { display: block; }
  </style>
</head>
<body>
  <h1>Survey Mind Map</h1>
  <div id="slider-container">
    <label for="depthSlider">Show to level:</label>
    <input type="range" id="depthSlider" min="1" max="3" value="3">
  </div>
  <div id="svg-wrapper">
    <!-- Adjust width/height as you like -->
    <svg width="1200" height="600"></svg>
  </div>

  <!-- Inline JSON data -->
  <script id="mindmap-data" type="application/json">
{
  "name": "Survey Organisation",
  "children": [
    {
      "name": "Demographics",
      "children": [
        { "name": "Age Range" },
        { "name": "Ethnicity Group" },
        { "name": "Gender Identity" },
        { "name": "LGBTQ+" },
        { "name": "Region of the UK" }
      ]
    },
    {
      "name": "Attendance",
      "children": [
        {
          "name": "Attendance",
          "children": [
            { "name": "Reason for this" },
            { "name": "Previous attendance" },
            { "name": "Method of attendance, e.g. ambulance" }
          ]
        },
        {
          "name": "Non-attendance",
          "children": [
            { "name": "Reason / Barriers" },
            { "name": "Perceived Impact and Outcome" }
          ]
        },
        {
          "name": "Leaving without being seen",
          "children": [
            { "name": "Reason / Barriers" },
            { "name": "Perceived Impact and Outcome" }
          ]
        }
      ]
    },
    {
      "name": "Disclosure",
      "children": [
        {
          "name": "Decision on whether to do so",
          "children": [
            { "name": "Factors that are involved" }
          ]
        },
        {
          "name": "Method of doing so",
          "children": [
            { "name": "Pre-disclosed (hospital passport, alert on patient records system)" },
            { "name": "Self-advocacy" }
          ]
        },
        {
          "name": "Perceived impact of decision",
          "children": [
            { "name": "Better or worse due to disclosure" },
            { "name": "Better or worse due to non-disclosure" }
          ]
        }
      ]
    },
    {
      "name": "Experience",
      "children": [
        {
          "name": "Rating of care and experience",
          "children": [
            { "name": "Scales and quantifying" }
          ]
        },
        {
          "name": "Barriers and Enablers",
          "children": [
            { "name": "Challenging aspects of the experience" },
            { "name": "The aspects that help" }
          ]
        }
      ]
    },
    {
      "name": "Key Barriers",
      "children": [
        {
          "name": "Sensory and Environmental",
          "children": [
            { "name": "Noise, visual, smell, crowding, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        },
        {
          "name": "Structural and Procedural",
          "children": [
            { "name": "Logistics, waiting areas, waiting time, patient pathway, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        },
        {
          "name": "Communication with Staff",
          "children": [
            { "name": "Staff empathy, agreement with staff, feeling cared for and understood, etc" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        }
      ]
    },
    {
      "name": "Pain",
      "children": [
        {
          "name": "Relationship with pain",
          "children": [
            { "name": "Perception" },
            { "name": "Tolerance" }
          ]
        },
        {
          "name": "Expressing and Communicating",
          "children": [
            { "name": "Staff empathy and understanding" },
            { "name": "Disclosure impact" },
            { "name": "Personal navigation strategies" }
          ]
        }
      ]
    },
    {
      "name": "Final Comments",
      "children": [
        { "name": "Chance to say anything not covered" }
      ]
    }
  ]
}
  </script>

  <script>
    const svg    = d3.select("svg"),
          width  = +svg.attr("width"),
          height = +svg.attr("height"),
          tree   = d3.tree().size([height, width - 160]);

    function update(depthLimit) {
      const raw  = document.getElementById("mindmap-data").textContent,
            data = JSON.parse(raw),
            root = d3.hierarchy(data);

      // Compute layout
      tree(root);

      // Filter by depth
      const nodes = root.descendants().filter(d => d.depth <= depthLimit),
            links = root.links().filter(d => d.source.depth < depthLimit);

      // Clear and redraw
      svg.selectAll("*").remove();
      const g = svg.append("g").attr("transform","translate(40,0)");

      // Links
      g.selectAll(".link")
       .data(links)
       .enter().append("path")
         .attr("class","link")
         .attr("d", d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

      // Nodes
      const nodeG = g.selectAll(".node")
                     .data(nodes)
                     .enter().append("g")
                       .attr("class","node")
                       .attr("transform",d=>`translate(${d.y},${d.x})`);

      nodeG.append("circle").attr("r",3.5);  // smaller circles
      nodeG.append("text")
           .attr("dy",3)
           .attr("x",d=>d.children ? -6 : 6)
           .attr("text-anchor",d=>d.children?"end":"start")
           .text(d=>d.data.name);
    }

    // Slider
    document.getElementById("depthSlider")
            .addEventListener("input", e => update(+e.target.value));

    // Initial draw at level 3
    update(3);
  </script>
</body>
</html>
